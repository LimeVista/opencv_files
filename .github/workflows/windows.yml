name: Windows Server 2019

on:
  pull_request:
    types: [synchronize, opened]

env:
  OPENCV_VERSION: 4.5.1

jobs:
  build:

    strategy:
      matrix:
        platform: ["win", "uwp"]
        arch: ["x86", "x64", "ARM"]
        exclude:
          - platform: Windows
            arch: ARM

    runs-on: windows-2019
    
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
          submodules: recursive

      - name: Install Server-Media-Foundation
        shell: powershell
        run: |
          Install-WindowsFeature Server-Media-Foundation

      - name: Build
        run: |
          if ("${{matrix.platform}}" -eq 'win'){
              vcpkg install tesseract:${{matrix.arch}}-windows-static
              vcpkg integrate install
              . ".\build_windows.ps1"
              BuildForWindows ${{matrix.arch}} "C:\Tools\vcpkg" $TRUE
          }
          elseif ("${{matrix.platform}}" -eq 'uwp'){
              . ".\build_uwp.ps1"
              BuildForUWP ${{matrix.arch}} "C:\Tools\vcpkg" $TRUE
          }

      - name: Upload artifacts
        uses: actions/upload-artifact@v1
        with:
          name: artifacts_${{matrix.platform}}-${{matrix.arch}}
          path: build_${{matrix.platform}}_${{matrix.arch}}/install
